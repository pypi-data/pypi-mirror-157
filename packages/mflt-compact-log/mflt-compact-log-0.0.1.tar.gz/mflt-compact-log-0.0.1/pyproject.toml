[tool.poetry]
name = "mflt-compact-log"
version = "0.0.1"
description = "Memfault Compact Log Library"
authors = ["Memfault Inc <hello@memfault.com>"]
repository = "https://github.com/memfault/memfault-firmware-sdk"
readme = "README.md"
license = "Proprietary"

packages = [{ include = "mflt_compact_log", from = "src" }]
exclude = [
  "**/*.c",
  "**/*.h",
  "src/mflt_compact_log/decode/scripts",
  "src/mflt_compact_log/decode/Dockerfile",
  "src/mflt_compact_log/decode/native_engine.py",
]

[tool.poetry.dependencies]
python = ">=3.8"
cbor2 = "^5"
click = "^8.0"
prettytable = "==0.7.2"
pyelftools = "^0.28.0"

# for python 3.10, there aren't v1.0.0 releases of the below packages. instead,
# select separately built+uploaded versions of those packages. generated from
# here: https://github.com/noahp/wasmer-python/tree/1.0.0-build
#
# updating to newer versions of the wasmer packages was problematic; some linker
# errors when building native .so's
wasmer = { version = "==1.0.0", python = ">=3.8 <3.10" }
wasmer-py310 = { version = "==1.0.0", python = "~3.10" }
wasmer-compiler-cranelift = { version = "==1.0.0", python = ">=3.8 <3.10" }
wasmer-compiler-cranelift-py310 = { version = "==1.0.0", python = "~3.10" }

[tool.poetry.dev-dependencies]
invoke = "1.4.1"
mflt-testing = { path = "../mflt-testing", develop = true }
pytest = "^6"
pytest-cov = "^2"
snapshottest = "1.0.0a0"

[tool.poetry.scripts]
"mflt-compact-log.compact" = 'mflt_compact_log.compact:main'
"mflt-compact-log.log_fmt" = 'mflt_compact_log.log_fmt:main'

[tool.black]
line-length = 100
target-version = ['py38']
include = '\.pyi?$'

[tool.isort]
# Black Compatible Settings from
# https://black.readthedocs.io/en/stable/the_black_code_style.html?highlight=isort#how-black-wraps-lines
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
line_length = 100

#
# NB: Uncommenting these lines will prevent installing the project in editable mode.
#
# [build-system]
# requires = ["poetry>=0.12"]
# build-backend = "poetry.masonry.api"
